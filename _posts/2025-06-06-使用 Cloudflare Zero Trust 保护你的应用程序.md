---
layout: mypost
title: ä½¿ç”¨ Cloudflare Zero Trust ä¿æŠ¤ä½ çš„åº”ç”¨ç¨‹åº
author: minc_nice_100
tags: ["Cloudflare", "Zero Trust"]
---

ç”±äºç¤¾å›¢çš„éœ€è¦, ç«™é•¿éœ€è¦æš´éœ²æœºå™¨ä¸Šçš„ä¸€äº›ç«¯ç‚¹, å¹¶è¿›è¡Œä¿æŠ¤ä»¥å…æœªç»æˆæƒçš„è®¿é—®, ç”±äºç«™é•¿ä½¿ç”¨ Cloudflare Tunnel è¿›è¡Œå†…ç½‘ç©¿é€, å› æ­¤éœ€è¦ä½¿ç”¨ Cloudflare Zero Trust è¿›è¡Œä¿æŠ¤.

*å®é™…ä¸Šæ˜¯å› ä¸ºæ‡’, æˆ‘ä¸æƒ³å†å®ç°é¢å¤–çš„å®‰å…¨å±‚ğŸ‘*

> ##### TIP
>
> æœ¬æ–‡å‡è®¾ä½ å·²ç»ç†Ÿç»ƒæŒæ¡ Cloudflare çš„ä½¿ç”¨, å¹¶ä¸”å®Œæˆ Zero Trust çš„æ³¨å†Œ.
> è¯·æå‰æ·»åŠ å¥½éœ€è¦çš„è§£æè®°å½•å’Œå’Œç©¿é€ä¸€ç±»çš„, æœ¬æ–‡ä¸å†èµ˜è¿°.
{: .block-tip }

## æ·»åŠ å¯é‡ç”¨ç­–ç•¥
é¦–å…ˆ, æˆ‘ä»¬**å¯ä»¥**åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨ç­–ç•¥, ä½ éœ€è¦è½¬åˆ°è¿™ä¸€ä¸ªé¡µé¢ `/access/policies?tab=reusable`, å…¶åœ¨ Zero Trust ä»ªè¡¨æ¿ä¸­.

![å¦‚å›¾æ‰€ç¤º](https://bucket.itedev.com/blog/782b6185b46d4ef39a652b8af05f0f10.avif)

ç„¶åæˆ‘ä»¬ç‚¹å‡»**æ·»åŠ ç­–ç•¥**æŒ‰é’®,å¹¶ä¸”æ·»åŠ  **Any Access Service Token** ä¸ **Valid Certificate** ä¸¤ä¸ªåŒ…æ‹¬é€‰æ‹©å™¨, æŒ‰éœ€æ·»åŠ å…¶ä»–å†…å®¹(æ¨èæ–°å»ºä¸€ä¸ªå¯é‡ç”¨ç­–ç•¥).

![é€‰æ‹©å™¨](https://bucket.itedev.com/blog/9403b1bd5102498e8222ffa355514ec6.avif)

åˆ«å¿˜è®°ç»™å®ƒä¸€ä¸ªåç§°, ç„¶åç‚¹å‡»**ä¿å­˜**.

## æ·»åŠ åº”ç”¨ç¨‹åº
æ¥ä¸‹æ¥, æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªåº”ç”¨ç¨‹åº, è½¬åˆ° `/access/apps`, ç„¶åç‚¹å‡»**æ·»åŠ åº”ç”¨ç¨‹åº**æŒ‰é’®, å¹¶é€‰æ‹©åº”ç”¨ç¨‹åºç±»å‹(æœ¬æ–‡ä»¥è‡ªæ‰˜ç®¡åº”ç”¨ç¨‹åºä¸ºä¾‹).
![é€‰æ‹©åº”ç”¨ç¨‹åºç±»å‹](https://bucket.itedev.com/blog/e14e870f86c4455e914e10451438bb61.avif)

ç„¶ååœ¨ Access ç­–ç•¥ä¸€æ é€‰æ‹©åˆšæ‰åˆ›å»ºçš„å¯é‡ç”¨ç­–ç•¥, ä¸ºåº”ç”¨ç¨‹åºèµ·ä¸ªåå­—, ç¼–è¾‘å…¶ä»–éœ€è¦çš„è®¾ç½®, ç„¶åç‚¹å‡»ä¸‹ä¸€æ­¥, ä¸€ç›´æ¥åˆ°é«˜çº§è®¾ç½®.
![Access ç­–ç•¥](https://bucket.itedev.com/blog/976e2983923843b9b5a6967256657c44.avif)

è®¤è¯å¡«å†™æ­¤é¡µçš„æ‰€æœ‰å†…å®¹, ç„¶åç‚¹å‡»ä¿å­˜. 
![CROS è®¾ç½®](https://bucket.itedev.com/blog/38ad0d1fef2a4c388cb072ad4ec512f9.avif) 
![æœåŠ¡èº«ä»½éªŒè¯ç­–ç•¥çš„ 401 å“åº”](https://bucket.itedev.com/blog/6b54714e241940b6ad971b1039e323ab.avif)

æ­¤æ—¶, æˆ‘ä»¬å®Œæˆäº†åº”ç”¨ç¨‹åºçš„è®¾ç½®, è®¿é—®ç›®æ ‡ç«¯ç‚¹, ç†è®ºä¸Šæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸‹é¢çš„å†…å®¹:
![Forbidden](https://bucket.itedev.com/blog/08f51da60ece434d9a8d3ec369663800.avif)

## åˆ›å»ºæœåŠ¡ä»¤ç‰Œ/è¯ä¹¦
æœ€å, æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæœåŠ¡ä»¤ç‰Œ(å½“ç„¶çš„ä½ ä¹Ÿå¯ä»¥ä¸¢ä¸€ç»„æ ¹è¯ä¹¦ç»™ Zero Trust, è®©å®ƒè‡ªå·±ç­¾çŸ­æœŸè¯ä¹¦æ‹¿æ¥æˆæƒ, æ­¤å¤„ä¸æ¼”ç¤º), ç”¨ä»¥è®¿é—®åº”ç”¨ç¨‹åº.
è½¬åˆ° `/access/service-auth`, ç‚¹å‡»åˆ›å»ºä¸€ä¸ªæœåŠ¡ä»¤ç‰Œ.

![åˆ›å»ºæœåŠ¡ä»¤ç‰Œ](https://bucket.itedev.com/blog/5ed17af7beeb41f393c6b42ebb986fd4.avif)

èµ·ä¸ªåå­—å¹¶é€‰æ‹©æœ‰æ•ˆæœŸ(ä¸æ¨èåˆ›å»ºæ— é™æœŸä»¤ç‰Œ, å¦åˆ™æ‚¨å¯èƒ½é­è€ç½ª..è¿«çœŸ), ç„¶åç‚¹å‡»**åˆ›å»º**.
æ­¤æ—¶ä½ ä¼šè·å¾—ä¸€ç»„ç±»ä¼¼ä¸‹æ–¹çš„ä»¤ç‰Œ:
```json
{
    "CF-Access-Client-Id": "***.access",
    "CF-Access-Client-Secret": "***"
}
```

è¿™æ˜¯ä¸¤ä¸ªæ ‡å¤´, åœ¨è¯·æ±‚é‡Œå¸¦ä¸Šå°±è¡Œ.
```bash
curl -H "CF-Access-Client-Id: ***.access" -H "CF-Access-Client-Secret: ***" https://example.com/api/endpoint
```

## æ€»ç»“
è‡³æ­¤, ä½ å·²ç»å­¦ä¼šå¦‚ä½•ä½¿ç”¨ Cloudflare Zero Trust ä¿æŠ¤ä½ çš„ç«¯ç‚¹, ä¿æŠ¤å¥½ä½ çš„ä»¤ç‰Œ/è¯ä¹¦(å¤§å£°!!).

æ¬¢è¿æ‰¾æˆ‘è®¨è®º: [ç•™è¨€æ¿](https://www.itedev.com/pages/chat)

## åè®°
æ–‡å­—é‡Œæ‰€æçš„ç«¯ç‚¹æ˜¯æš´éœ²ç»™ Sean (é²¤é±¼ğŸŸ)ä»–ä»¬çš„ä¸€ä¸ªç¤¾å›¢çš„, [ä½ å¯ä»¥åˆ°è¿™é‡Œæ‰¾ğŸŸç©](https://makabaka1880.xyz/)

å…¶è¯„è®ºåŒºç”¨ä¸äº†, é‚£æ˜¯æˆ‘è¿˜æ²¡ä¿®å¥½(æ‰˜ç®¡åœ¨æˆ‘è¿™www).